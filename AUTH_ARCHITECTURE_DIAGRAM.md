# ğŸ¨ Authentication System Architecture Diagram

## ğŸ“Š Complete System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          FLUTTER MOBILE APP                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  Login Screen    â”‚           â”‚  Register Screen â”‚                  â”‚
â”‚  â”‚  â€¢ Email         â”‚           â”‚  â€¢ Email         â”‚                  â”‚
â”‚  â”‚  â€¢ Password      â”‚           â”‚  â€¢ Password      â”‚                  â”‚
â”‚  â”‚  [Login Button]  â”‚           â”‚  â€¢ Username      â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚  [Sign Up Button]â”‚                  â”‚
â”‚           â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚           â”‚                              â”‚                             â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                          â”‚                                             â”‚
â”‚                          â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚          AuthProvider (State Management)           â”‚               â”‚
â”‚  â”‚  â€¢ isAuthenticated: bool                           â”‚               â”‚
â”‚  â”‚  â€¢ currentUser: User?                              â”‚               â”‚
â”‚  â”‚  â€¢ login(), register(), logout()                   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                      â”‚                                                 â”‚
â”‚                      â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚          AuthService (Authentication)              â”‚               â”‚
â”‚  â”‚  â€¢ _accessToken: String?                           â”‚               â”‚
â”‚  â”‚  â€¢ _currentUserId: String?                         â”‚               â”‚
â”‚  â”‚  â€¢ initialize() - Auto-login                       â”‚               â”‚
â”‚  â”‚  â€¢ register() - Create account                     â”‚               â”‚
â”‚  â”‚  â€¢ login() - Authenticate                          â”‚               â”‚
â”‚  â”‚  â€¢ logout() - Clear session                        â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                      â”‚                                                 â”‚
â”‚                      â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚          ApiService (HTTP Client)                  â”‚               â”‚
â”‚  â”‚  â€¢ Dio instance with interceptors                  â”‚               â”‚
â”‚  â”‚  â€¢ signup(), login(), getMyProfile()               â”‚               â”‚
â”‚  â”‚  â€¢ syncVitals(), getActivities(), etc.             â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                      â”‚                                                 â”‚
â”‚                      â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚      Flutter Secure Storage (Encrypted)            â”‚               â”‚
â”‚  â”‚  â€¢ access_token: "eyJhbGc..."                      â”‚               â”‚
â”‚  â”‚  â€¢ user_id: "abc123xyz"                            â”‚               â”‚
â”‚  â”‚  â€¢ username: "john_doe"                            â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ HTTPS (Production)
                                 â”‚ HTTP (Development)
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PYTHON BACKEND (FastAPI)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚           API Routes (FastAPI Endpoints)           â”‚               â”‚
â”‚  â”‚                                                     â”‚               â”‚
â”‚  â”‚  POST /api/v1/auth/signup                          â”‚               â”‚
â”‚  â”‚  â”œâ”€ Validate email, password                       â”‚               â”‚
â”‚  â”‚  â”œâ”€ Hash password (bcrypt)                         â”‚               â”‚
â”‚  â”‚  â”œâ”€ Create user in Firestore                       â”‚               â”‚
â”‚  â”‚  â”œâ”€ Generate JWT token                             â”‚               â”‚
â”‚  â”‚  â””â”€ Return {access_token, user_id, ...}            â”‚               â”‚
â”‚  â”‚                                                     â”‚               â”‚
â”‚  â”‚  POST /api/v1/auth/login                           â”‚               â”‚
â”‚  â”‚  â”œâ”€ Find user by email                             â”‚               â”‚
â”‚  â”‚  â”œâ”€ Verify password (bcrypt)                       â”‚               â”‚
â”‚  â”‚  â”œâ”€ Generate JWT token                             â”‚               â”‚
â”‚  â”‚  â””â”€ Return {access_token, user_id, ...}            â”‚               â”‚
â”‚  â”‚                                                     â”‚               â”‚
â”‚  â”‚  GET /api/v1/users/me/profile                      â”‚               â”‚
â”‚  â”‚  â””â”€ Depends(get_current_user) ğŸ”’                   â”‚               â”‚
â”‚  â”‚                                                     â”‚               â”‚
â”‚  â”‚  POST /api/v1/vitals/sync                          â”‚               â”‚
â”‚  â”‚  â””â”€ Depends(get_current_user) ğŸ”’                   â”‚               â”‚
â”‚  â”‚                                                     â”‚               â”‚
â”‚  â”‚  GET /api/v1/activities/historical                 â”‚               â”‚
â”‚  â”‚  â””â”€ Depends(get_current_user) ğŸ”’                   â”‚               â”‚
â”‚  â”‚                                                     â”‚               â”‚
â”‚  â”‚  ... (all other endpoints protected) ğŸ”’            â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                       â”‚                                                â”‚
â”‚                       â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚     Dependencies (Middleware)                      â”‚               â”‚
â”‚  â”‚                                                     â”‚               â”‚
â”‚  â”‚  async def get_current_user(                       â”‚               â”‚
â”‚  â”‚      credentials: HTTPAuthorizationCredentials     â”‚               â”‚
â”‚  â”‚  ):                                                 â”‚               â”‚
â”‚  â”‚      1. Extract token from "Authorization" header  â”‚               â”‚
â”‚  â”‚      2. Verify JWT signature with SECRET_KEY       â”‚               â”‚
â”‚  â”‚      3. Check token expiration                     â”‚               â”‚
â”‚  â”‚      4. Extract user_id from payload               â”‚               â”‚
â”‚  â”‚      5. Return user dict or raise 401              â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                       â”‚                                                â”‚
â”‚                       â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚         AuthService (Business Logic)               â”‚               â”‚
â”‚  â”‚                                                     â”‚               â”‚
â”‚  â”‚  â€¢ signup(email, password, username)               â”‚               â”‚
â”‚  â”‚    â”œâ”€ Hash password with bcrypt                    â”‚               â”‚
â”‚  â”‚    â”œâ”€ Create user in Firestore                     â”‚               â”‚
â”‚  â”‚    â””â”€ Return user data                             â”‚               â”‚
â”‚  â”‚                                                     â”‚               â”‚
â”‚  â”‚  â€¢ login(email, password)                          â”‚               â”‚
â”‚  â”‚    â”œâ”€ Find user in Firestore                       â”‚               â”‚
â”‚  â”‚    â”œâ”€ Verify password with bcrypt                  â”‚               â”‚
â”‚  â”‚    â””â”€ Return user data                             â”‚               â”‚
â”‚  â”‚                                                     â”‚               â”‚
â”‚  â”‚  â€¢ create_token(user_data)                         â”‚               â”‚
â”‚  â”‚    â””â”€ Generate JWT with 7-day expiry               â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                       â”‚                                                â”‚
â”‚                       â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚        SecurityUtils (Cryptography)                â”‚               â”‚
â”‚  â”‚                                                     â”‚               â”‚
â”‚  â”‚  â€¢ hash_password(plain) â†’ bcrypt_hash              â”‚               â”‚
â”‚  â”‚  â€¢ verify_password(plain, hash) â†’ bool             â”‚               â”‚
â”‚  â”‚  â€¢ create_access_token(data) â†’ JWT string          â”‚               â”‚
â”‚  â”‚  â€¢ verify_token(token) â†’ payload or None           â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                       â”‚                                                â”‚
â”‚                       â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚       FirebaseService (Database Access)            â”‚               â”‚
â”‚  â”‚                                                     â”‚               â”‚
â”‚  â”‚  â€¢ create_user(user_data)                          â”‚               â”‚
â”‚  â”‚  â€¢ get_user_by_email(email)                        â”‚               â”‚
â”‚  â”‚  â€¢ get_user_by_id(user_id)                         â”‚               â”‚
â”‚  â”‚  â€¢ update_user(user_id, data)                      â”‚               â”‚
â”‚  â”‚  â€¢ store_daily_vitals(user_id, date, data)         â”‚               â”‚
â”‚  â”‚  â€¢ get_vitals_range(user_id, start, end)           â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                       â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      GOOGLE FIRESTORE (Cloud Database)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Collection: Users                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  Document: abc123xyz                         â”‚                     â”‚
â”‚  â”‚  {                                            â”‚                     â”‚
â”‚  â”‚    "id": "abc123xyz",                         â”‚                     â”‚
â”‚  â”‚    "email": "user@example.com",               â”‚                     â”‚
â”‚  â”‚    "password_hash": "$2b$12$...",             â”‚                     â”‚
â”‚  â”‚    "username": "john_doe",                    â”‚                     â”‚
â”‚  â”‚    "full_name": "John Doe",                   â”‚                     â”‚
â”‚  â”‚    "created_at": "2025-11-17T...",            â”‚                     â”‚
â”‚  â”‚    "last_login": "2025-11-17T..."             â”‚                     â”‚
â”‚  â”‚  }                                            â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                         â”‚
â”‚  Collection: UserProfiles                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  Document: abc123xyz                         â”‚                     â”‚
â”‚  â”‚  {                                            â”‚                     â”‚
â”‚  â”‚    "user_id": "abc123xyz",                    â”‚                     â”‚
â”‚  â”‚    "age": 30,                                 â”‚                     â”‚
â”‚  â”‚    "gender": "male",                          â”‚                     â”‚
â”‚  â”‚    "weight_kg": 75.0,                         â”‚                     â”‚
â”‚  â”‚    "height_cm": 180.0,                        â”‚                     â”‚
â”‚  â”‚    "daily_calorie_goal": 2000,                â”‚                     â”‚
â”‚  â”‚    "daily_step_goal": 10000,                  â”‚                     â”‚
â”‚  â”‚    ...                                        â”‚                     â”‚
â”‚  â”‚  }                                            â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                         â”‚
â”‚  Collection: DailyVitals/{user_id}/vitals                              â”‚
â”‚  Collection: DailyActivities/{user_id}/activities                      â”‚
â”‚  Collection: NutritionEntries/{user_id}/entries                        â”‚
â”‚  Collection: Alerts/{user_id}/alerts                                   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Request Flow Example

### User Logs In
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Flutter   â”‚       â”‚  ApiService â”‚       â”‚   Backend   â”‚       â”‚  Firestore  â”‚
â”‚LoginScreen  â”‚       â”‚  (Dio HTTP) â”‚       â”‚   (FastAPI) â”‚       â”‚ (Database)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚                     â”‚                     â”‚
       â”‚ login()             â”‚                     â”‚                     â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚                     â”‚
       â”‚                     â”‚ POST /auth/login    â”‚                     â”‚
       â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
       â”‚                     â”‚ {email, password}   â”‚                     â”‚
       â”‚                     â”‚                     â”‚ get_user_by_email() â”‚
       â”‚                     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                     â”‚                     â”‚                     â”‚
       â”‚                     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                     â”‚                     â”‚ {user_data}         â”‚
       â”‚                     â”‚                     â”‚                     â”‚
       â”‚                     â”‚                     â”‚ verify_password()   â”‚
       â”‚                     â”‚                     â”‚ âœ… Match            â”‚
       â”‚                     â”‚                     â”‚                     â”‚
       â”‚                     â”‚                     â”‚ create_jwt_token()  â”‚
       â”‚                     â”‚                     â”‚ ğŸ” Token generated  â”‚
       â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
       â”‚                     â”‚ {access_token, ...} â”‚                     â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                     â”‚
       â”‚ {access_token, ...} â”‚                     â”‚                     â”‚
       â”‚                     â”‚                     â”‚                     â”‚
       â”‚ Store in SecureStorage                    â”‚                     â”‚
       â”‚ âœ… Logged In        â”‚                     â”‚                     â”‚
       â”‚                     â”‚                     â”‚                     â”‚
```

### User Syncs Vitals (Authenticated Request)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Flutter   â”‚       â”‚  ApiService â”‚       â”‚   Backend   â”‚       â”‚  Firestore  â”‚
â”‚HomeScreen   â”‚       â”‚  (Dio HTTP) â”‚       â”‚   (FastAPI) â”‚       â”‚ (Database)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚                     â”‚                     â”‚
       â”‚ syncVitals()        â”‚                     â”‚                     â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚                     â”‚
       â”‚                     â”‚ Read token from     â”‚                     â”‚
       â”‚                     â”‚ SecureStorage       â”‚                     â”‚
       â”‚                     â”‚ ğŸ”‘ Token: eyJh...   â”‚                     â”‚
       â”‚                     â”‚                     â”‚                     â”‚
       â”‚                     â”‚ POST /vitals/sync   â”‚                     â”‚
       â”‚                     â”‚ Header:             â”‚                     â”‚
       â”‚                     â”‚ Authorization:      â”‚                     â”‚
       â”‚                     â”‚ Bearer eyJh...      â”‚                     â”‚
       â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
       â”‚                     â”‚                     â”‚ verify_token()      â”‚
       â”‚                     â”‚                     â”‚ âœ… Valid           â”‚
       â”‚                     â”‚                     â”‚ Extract user_id     â”‚
       â”‚                     â”‚                     â”‚                     â”‚
       â”‚                     â”‚                     â”‚ store_vitals()      â”‚
       â”‚                     â”‚                     â”‚ for user_id         â”‚
       â”‚                     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                     â”‚                     â”‚                     â”‚
       â”‚                     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                     â”‚                     â”‚ âœ… Stored           â”‚
       â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
       â”‚                     â”‚ {success: true}     â”‚                     â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                     â”‚
       â”‚ {success: true}     â”‚                     â”‚                     â”‚
       â”‚                     â”‚                     â”‚                     â”‚
```

### Token Expires (Auto-Logout)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Flutter   â”‚       â”‚  ApiService â”‚       â”‚   Backend   â”‚
â”‚  Any Screen â”‚       â”‚  (Dio HTTP) â”‚       â”‚   (FastAPI) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚                     â”‚
       â”‚ getProfile()        â”‚                     â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
       â”‚                     â”‚ GET /users/me       â”‚
       â”‚                     â”‚ Header:             â”‚
       â”‚                     â”‚ Authorization:      â”‚
       â”‚                     â”‚ Bearer EXPIRED_TOKENâ”‚
       â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                     â”‚                     â”‚ verify_token()      â”‚
       â”‚                     â”‚                     â”‚ âŒ Expired/Invalid  â”‚
       â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                     â”‚ 401 Unauthorized    â”‚
       â”‚                     â”‚                     â”‚
       â”‚                     â”‚ Interceptor catches â”‚
       â”‚                     â”‚ 401 error           â”‚
       â”‚                     â”‚                     â”‚
       â”‚                     â”‚ logout()            â”‚
       â”‚                     â”‚ Clear SecureStorage â”‚
       â”‚                     â”‚                     â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
       â”‚ Navigate to Login   â”‚                     â”‚
       â”‚                     â”‚                     â”‚
```

## ğŸ” Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1: HTTPS Encryption (Production)             â”‚
â”‚  â””â”€ All data encrypted in transit                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 2: JWT Token Signature                       â”‚
â”‚  â””â”€ HMAC-SHA256 with SECRET_KEY                     â”‚
â”‚  â””â”€ Prevents token tampering                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 3: Token Expiration                          â”‚
â”‚  â””â”€ 7-day validity                                  â”‚
â”‚  â””â”€ Limits damage from stolen tokens                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 4: bcrypt Password Hashing                   â”‚
â”‚  â””â”€ Slow hashing (prevents brute force)             â”‚
â”‚  â””â”€ Automatic salt (prevents rainbow tables)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 5: Secure Storage                            â”‚
â”‚  â””â”€ Flutter Secure Storage (device encryption)      â”‚
â”‚  â””â”€ Never stores passwords                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ Data Storage Comparison

### âŒ BEFORE (Insecure)
```
SharedPreferences (Plain Text):
â”œâ”€ username: "john_doe"
â”œâ”€ password: "MyPassword123"    âš ï¸ PLAIN TEXT!
â””â”€ remember_me: true

Backend: SHA256 password hash      âš ï¸ NOT SECURE!
No authentication tokens           âš ï¸ All users = demo_user_01
```

### âœ… AFTER (Secure)
```
Flutter Secure Storage (Encrypted):
â”œâ”€ access_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
â”œâ”€ user_id: "abc123xyz"
â””â”€ username: "john_doe"

Backend: bcrypt password hash      âœ… SECURE!
JWT tokens with expiration         âœ… Each user authenticated
```

---

## ğŸ¯ Summary

This diagram shows:
1. **Frontend**: Flutter app with secure token storage
2. **Backend**: FastAPI with JWT authentication
3. **Database**: Firestore with per-user data isolation
4. **Security**: Multiple layers of protection
5. **User Experience**: Seamless auto-login/logout

**Your authentication system is enterprise-grade and production-ready!** ğŸš€
